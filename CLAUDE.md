# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

TREF (Traceable Reference Format) is an open, transportable, and verifiable block format for preserving, validating, and reusing knowledge with traceable source origin. It's a knowledge-bearing object format (not a CMS or AI model) where content, metadata, licenses, references, and history are combined in self-contained units.

## Architecture: Single Source Principle

**One source, many outputs.** All UI components live in `src/` and are built to `dist/`. Nothing is hardcoded or copied.

```
src/wrapper/wrapper.js    ← SINGLE SOURCE OF TRUTH
        │
    npm run build
        ▼
dist/tref-block.js        ← Built output
        │
        ├──> CDN (jsdelivr/unpkg)
        └──> npm install tref-block
```

### Directory Structure

```
TRefBlocks/
├── src/                  # SOURCE - the only place code is written
│   ├── wrapper/          #   UI components (wrapper.js)
│   ├── cli/              #   CLI tool
│   ├── mcp/              #   MCP server
│   └── index.js          #   Main entry, schemas
│
├── dist/                 # BUILT - generated by npm, never edited
│   └── tref-block.js     #   ES module bundle
│
├── demo/                 # DEMO - imports from dist/
│   └── index.html        #   Visual testing page
│
├── docs/                 # SITE - GitHub Pages (tref.lpmwfx.com)
│
└── doc/                  # DOCUMENTATION - project docs
    ├── project.md        #   Project overview
    └── TrefBlockUIUX.md  #   UI/UX specification
```

## Commands

```bash
# Build browser library (src/ → dist/)
npm run build:browser     # Bundles wrapper.js to dist/tref-block.js

# Full build (browser + CLI)
npm run build             # All build targets

# Development server
npm run dev               # Serves on http://localhost:8080

# Quality checks
npm run check             # typecheck + lint + format check
npm run typecheck         # TypeScript checking (no emit)
npm run lint              # ESLint
npm run format:check      # Prettier check

# Fix/format
npm run lint:fix          # ESLint --fix
npm run format            # Prettier --write

# Run tests
npm test                  # node --test
```

## Development Approach: TypeScript-Level Safety in Pure JavaScript

This project uses ES2024 JavaScript with JSDoc type annotations, validated by TypeScript CLI without transpilation.

**The safety stack:**
- **JSDoc** → Static types via comments
- **TypeScript CLI** → Type checking (no emit)
- **ESLint + typescript-eslint** → Type-aware linting
- **Zod** → Runtime validation at boundaries
- **Prettier** → Formatting

## Code Patterns

### Type Annotations (JSDoc)

```javascript
/** @typedef {z.infer<typeof SomeSchema>} SomeType */

/**
 * @param {unknown} data - Use unknown for external input
 * @returns {SomeType}
 */
function parse(data) {
  return SomeSchema.parse(data);
}
```

### Runtime Validation with Zod

Use Zod schemas for all external data boundaries. Derive types from schemas using `z.infer<typeof Schema>`.

```javascript
const Schema = z.object({
  id: z.string().uuid(),
  type: z.enum(['text', 'code', 'image']),
});

/** @typedef {z.infer<typeof Schema>} MyType */
```

## Integration

**CDN (recommended for websites):**
```html
<script type="module">
  import { TrefWrapper } from 'https://cdn.jsdelivr.net/npm/tref-block';
</script>
```

**npm (for JS projects):**
```bash
npm install tref-block
```
```javascript
import { TrefWrapper } from 'tref-block';
```

## Language Rule

**All content in English before push.** Translate any Danish text in code, docs, and project files to English before committing/pushing.
