{
  "v": 1,
  "id": "sha256:49d63a28fd6d44b0a6e2b024a8b7396b8539d662a0827d5b1969508563b33758",
  "content": "# Integration Guide\n\nHow to correctly display TREF blocks with proper UI/UX.\n\n## The Problem\n\nTREF blocks are JSON data. To display them with the correct UI (icon, hover menu, drag-drop, validation), you need `wrapper.js`. Without it, you just have raw JSON.\n\n## Required Steps\n\nEvery TREF integration needs three things:\n\n1. **Import TrefWrapper** from the library\n2. **Inject CSS** from `TrefWrapper.getStyles()`\n3. **Attach events** after rendering HTML\n\nMiss any step and the UI breaks.\n\n## Correct Pattern\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n  <!-- 1. Empty style tag for CSS injection -->\n  <style id=\"tref-styles\"></style>\n</head>\n<body>\n  <!-- Container for the block -->\n  <div id=\"my-block\"></div>\n\n  <script type=\"module\">\n    import { TrefWrapper } from 'https://cdn.jsdelivr.net/npm/tref-block';\n\n    // 2. Inject CSS (MUST be done before rendering)\n    document.getElementById('tref-styles').textContent = TrefWrapper.getStyles();\n\n    // Your TREF block data\n    const block = {\n      v: 1,\n      id: 'sha256:abc123...',\n      content: '# Hello World',\n      meta: { created: '2026-01-08', license: 'CC-BY-4.0' }\n    };\n\n    // 3. Create wrapper, render HTML, attach events\n    const wrapper = new TrefWrapper(block);\n    const container = document.getElementById('my-block');\n    container.innerHTML = wrapper.toHTML();\n    wrapper.attachEvents(container.querySelector('.tref-wrapper'));\n  </script>\n</body>\n</html>\n```\n\n## What Each Step Does\n\n### Step 1: Style Tag\n\n```html\n<style id=\"tref-styles\"></style>\n```\n\nAn empty style element in `<head>`. CSS is injected here dynamically.\n\n### Step 2: Inject CSS\n\n```javascript\ndocument.getElementById('tref-styles').textContent = TrefWrapper.getStyles();\n```\n\n`getStyles()` returns all CSS needed for:\n- Icon appearance (purple-mint theme)\n- Hover menu styling\n- Action button states\n- Validation indicators (red X for tampered)\n- Dark mode support\n\n**Without this**: Icon appears but menu is unstyled or invisible.\n\n### Step 3: Attach Events\n\n```javascript\nwrapper.attachEvents(container.querySelector('.tref-wrapper'));\n```\n\nBinds all interactive behavior:\n- Drag-and-drop on icon\n- Click handlers on action buttons\n- Touch support (tap, long-press)\n- Keyboard navigation\n- **Auto-validation** (checks SHA-256 hash)\n\n**Without this**: Icon is static, no hover menu, no drag, no validation.\n\n## Common Mistakes\n\n### Mistake 1: Missing CSS\n\n```javascript\n// WRONG - no CSS injection\nconst wrapper = new TrefWrapper(block);\ncontainer.innerHTML = wrapper.toHTML();\nwrapper.attachEvents(container.querySelector('.tref-wrapper'));\n```\n\nResult: Icon appears but hover menu is invisible or broken.\n\n### Mistake 2: Missing attachEvents\n\n```javascript\n// WRONG - no event binding\ndocument.getElementById('tref-styles').textContent = TrefWrapper.getStyles();\nconst wrapper = new TrefWrapper(block);\ncontainer.innerHTML = wrapper.toHTML();\n// Forgot attachEvents!\n```\n\nResult: Icon looks correct but nothing happens on click/hover/drag.\n\n### Mistake 3: Wrong Element for attachEvents\n\n```javascript\n// WRONG - attaching to container instead of .tref-wrapper\nwrapper.attachEvents(container);\n```\n\nResult: Events don't work. Must attach to `.tref-wrapper` element.\n\n### Mistake 4: Using CDN Without Building\n\n```javascript\n// May fail if version not published\nimport { TrefWrapper } from 'https://cdn.jsdelivr.net/npm/tref-block@0.3.0';\n```\n\nFor local development, use relative path to built file:\n\n```javascript\nimport { TrefWrapper } from './js/tref-block.js';\n```\n\n## Drop Zone Integration\n\nIf you also need to receive TREF blocks:\n\n```javascript\nimport { TrefWrapper, TrefReceiver } from 'tref-block';\n\n// Include both CSS\ndocument.getElementById('tref-styles').textContent =\n  TrefWrapper.getStyles() + TrefReceiver.getStyles();\n\n// Create receiver\nconst receiver = new TrefReceiver(dropZoneElement, {\n  onReceive: (wrapper) => {\n    console.log('Received block:', wrapper.block);\n  },\n  onError: (err) => {\n    console.error('Drop error:', err);\n  }\n});\n```\n\n## Build-Time Integration\n\nFor static site generators, the pattern is the same but in your build script:\n\n```javascript\n// build.js\nimport { TrefWrapper } from 'tref-block';\n\nfunction generatePage(block) {\n  return `<!DOCTYPE html>\n<html>\n<head>\n  <style id=\"tref-styles\"></style>\n</head>\n<body>\n  <div id=\"block-container\"></div>\n  <script type=\"module\">\n    import { TrefWrapper } from '/js/tref-block.js';\n    document.getElementById('tref-styles').textContent = TrefWrapper.getStyles();\n\n    const block = ${JSON.stringify(block)};\n    const wrapper = new TrefWrapper(block);\n    document.getElementById('block-container').innerHTML = wrapper.toHTML();\n    wrapper.attachEvents(document.querySelector('.tref-wrapper'));\n  </script>\n</body>\n</html>`;\n}\n```\n\n## Validation Indicator\n\nWhen `attachEvents()` runs, it automatically validates the block's SHA-256 hash.\n\n- **Valid**: Normal purple-mint icon\n- **Invalid**: Red X overlay, \"Modified content\" warning\n\nYou can also validate manually:\n\n```javascript\nconst result = await wrapper.validate();\nif (!result.valid) {\n  console.log('Content was modified!');\n  console.log('Expected:', result.expected);\n  console.log('Actual:', result.actual);\n}\n```\n\n## Checklist\n\nBefore deploying TREF blocks, verify:\n\n- [ ] `<style id=\"tref-styles\"></style>` in `<head>`\n- [ ] `TrefWrapper.getStyles()` injected into style tag\n- [ ] `wrapper.toHTML()` renders the block\n- [ ] `wrapper.attachEvents()` called on `.tref-wrapper` element\n- [ ] Using correct import path (CDN or local build)\n- [ ] Testing hover menu appears and works\n- [ ] Testing drag-and-drop works\n- [ ] Testing on mobile (tap toggles menu)",
  "meta": {
    "created": "2026-01-08T22:01:32.020Z",
    "license": "CC-BY-4.0",
    "author": "TREF Documentation"
  },
  "refs": [
    {
      "type": "url",
      "url": "https://tref.lpmwfx.com/wiki/pages/integration.html",
      "title": "Integration Guide"
    }
  ]
}