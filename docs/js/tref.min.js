"use strict";var TREF=(()=>{var x=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var S=(e,t)=>{for(var r in t)x(e,r,{get:t[r],enumerable:!0})},D=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of k(t))!R.call(e,n)&&n!==r&&x(e,n,{get:()=>t[n],enumerable:!(a=L(t,n))||a.enumerable});return e};var O=e=>D(x({},"__esModule",{value:!0}),e);var M={};S(M,{TREF_ICON_DATA_URL:()=>v,TREF_ICON_SVG:()=>d,TREF_MIME_TYPE:()=>c,TrefReceiver:()=>f,TrefWrapper:()=>l,createDraft:()=>b,derive:()=>C,getStyles:()=>E,publish:()=>w,unwrap:()=>h,validate:()=>T,wrap:()=>p});var _=".tref",d=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="24" height="24">
  <rect x="6" y="6" width="88" height="88" rx="12" ry="12" fill="#2D1B4E" stroke="#5CCCCC" stroke-width="5"/>
  <g transform="translate(50 50) scale(0.022) translate(-1125 -1125)">
    <g transform="translate(0,2250) scale(1,-1)" fill="#5CCCCC">
      <path d="M1515 2244 c-66 -10 -144 -38 -220 -77 -67 -35 -106 -67 -237 -195 -155 -152 -188 -195 -188 -247 0 -41 30 -95 64 -116 39 -24 113 -25 146 -3 14 9 90 81 170 160 183 181 216 199 350 199 83 0 103 -4 155 -28 78 -36 146 -104 182 -181 24 -53 28 -73 28 -151 0 -137 -21 -175 -199 -355 -79 -80 -151 -156 -160 -170 -39 -59 -8 -162 58 -194 81 -38 113 -22 284 147 165 163 230 252 268 370 24 71 28 99 28 202 0 106 -3 130 -28 200 -91 261 -310 428 -579 439 -50 3 -105 2 -122 0z"/>
      <path d="M1395 1585 c-17 -9 -189 -174 -382 -368 -377 -378 -383 -385 -362 -461 21 -76 87 -116 166 -101 33 6 80 49 386 353 191 191 358 362 369 381 26 42 28 109 4 146 -39 59 -118 81 -181 50z"/>
      <path d="M463 1364 c-47 -24 -323 -310 -365 -379 -20 -33 -49 -96 -64 -140 -24 -69 -28 -96 -28 -195 0 -127 14 -190 66 -294 63 -126 157 -220 284 -284 104 -52 167 -66 294 -66 99 0 126 4 195 28 44 15 107 44 140 64 65 39 348 309 371 354 41 78 -10 184 -96 203 -61 13 -98 -11 -256 -166 -186 -183 -222 -204 -359 -204 -77 0 -98 4 -147 27 -79 37 -142 98 -181 177 -29 59 -32 74 -32 156 0 136 21 174 199 355 79 80 150 156 159 170 23 33 22 107 -2 146 -35 57 -115 79 -178 48z"/>
    </g>
  </g>
</svg>`,c="application/vnd.tref+json",v="data:image/svg+xml,"+encodeURIComponent(d);function I(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function N(e){if(!e||typeof e!="object")return!1;let t=e;return!(t.v!==1||typeof t.id!="string"||!t.id.startsWith("sha256:")||typeof t.content!="string"||!t.meta||typeof t.meta!="object")}var l=class{#t;constructor(t){if(!N(t))throw new Error("Invalid TREF block");this.#t=t}get block(){return this.#t}get id(){return this.#t.id}get shortId(){return this.#t.id.replace("sha256:","").slice(0,8)}get content(){return this.#t.content}toJSON(t={}){return t.pretty?JSON.stringify(this.#t,null,2):JSON.stringify(this.#t)}getFilename(){return this.#t.id.replace("sha256:","")+_}toBlob(){return new Blob([this.toJSON()],{type:c})}toDataURL(){let t=this.toJSON(),r=btoa(unescape(encodeURIComponent(t)));return`data:${c};base64,${r}`}toObjectURL(){return URL.createObjectURL(this.toBlob())}async copyToClipboard(){await navigator.clipboard.writeText(this.toJSON())}async copyContentToClipboard(){await navigator.clipboard.writeText(this.#t.content)}getDragData(){let t=this.toJSON();return[{type:c,data:t},{type:"application/json",data:t},{type:"text/plain",data:t}]}setDragData(t){for(let{type:r,data:a}of this.getDragData())t.setData(r,a)}toHTML(t={}){let{includeContent:r=!0,interactive:a=!0,maxContentLength:n=200}=t,o=this.#t.content.length>n?this.#t.content.slice(0,n)+"...":this.#t.content,i=r?`<div class="tref-content">${I(o)}</div>`:"",u=this.#t.refs&&this.#t.refs.length>0?`<div class="tref-refs">${this.#t.refs.filter(s=>s.type==="url"&&s.url).map(s=>`<a href="${s.url}" target="_blank">${s.title||s.url}</a>`).join(", ")}</div>`:"",g=a?`<div class="tref-actions">
        <span class="tref-hint">drag me</span>
        <button class="tref-btn" data-action="copy" title="Copy JSON">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
        </button>
        <button class="tref-btn" data-action="download" title="Download .tref">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
        </button>
      </div>`:"";return`<div class="tref-wrapper" data-tref-id="${this.#t.id}">
  <div class="tref-header">
    <span class="tref-icon" draggable="true" title="Drag to share">${d}</span>
    <span class="tref-id">${this.shortId}</span>
    <span class="tref-meta">${this.#t.meta.created.split("T")[0]}</span>
    ${g}
  </div>
  ${i}
  ${u}
</div>`}attachEvents(t){let r=t.querySelector(".tref-icon");r&&r.addEventListener("dragstart",n=>{let o=n;o.dataTransfer&&(this.setDragData(o.dataTransfer),o.dataTransfer.effectAllowed="copy")});let a=async n=>{n.stopPropagation();let o=n.currentTarget.dataset.action,i=t.querySelector(".tref-id"),u=i?.textContent||"";try{if(o==="copy")await this.copyToClipboard(),i&&(i.textContent="Copied!");else if(o==="download"){let g=this.toObjectURL(),s=document.createElement("a");s.href=g,s.download=this.getFilename(),s.click(),URL.revokeObjectURL(g),i&&(i.textContent="Saved!")}setTimeout(()=>{i&&(i.textContent=u)},1500)}catch{i&&(i.textContent="Error"),setTimeout(()=>{i&&(i.textContent=u)},1500)}};t.querySelectorAll(".tref-btn").forEach(n=>{n.addEventListener("click",o=>{a(o)})})}static getStyles(){return`
.tref-wrapper {
  font-family: system-ui, -apple-system, sans-serif;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 12px;
  background: #fafafa;
  max-width: 400px;
}
.tref-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}
.tref-icon {
  display: inline-flex;
  width: 24px;
  height: 24px;
  cursor: grab;
  transition: transform 0.15s;
}
.tref-icon:hover { transform: scale(1.1); }
.tref-icon:active { cursor: grabbing; }
.tref-icon svg { width: 100%; height: 100%; }
.tref-id {
  font-family: monospace;
  font-size: 12px;
  color: #6b7280;
  background: #e5e7eb;
  padding: 2px 6px;
  border-radius: 4px;
  transition: all 0.2s;
}
.tref-meta { font-size: 12px; color: #9ca3af; }
.tref-actions {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 4px;
  opacity: 0;
  transition: opacity 0.15s;
}
.tref-wrapper:hover .tref-actions { opacity: 1; }
.tref-hint {
  font-size: 11px;
  color: #9ca3af;
  margin-right: 4px;
}
.tref-btn {
  background: transparent;
  border: none;
  padding: 4px;
  cursor: pointer;
  color: #6b7280;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s;
}
.tref-btn:hover {
  background: #e5e7eb;
  color: #374151;
}
.tref-content {
  font-size: 14px;
  line-height: 1.5;
  color: #374151;
  white-space: pre-wrap;
  word-break: break-word;
}
.tref-refs {
  margin-top: 8px;
  padding-top: 8px;
  border-top: 1px solid #e5e7eb;
  font-size: 12px;
  color: #6b7280;
}
.tref-refs a { color: #5CCCCC; text-decoration: none; }
.tref-refs a:hover { text-decoration: underline; }
`}},f=class{#t;#r;#e;constructor(t,r={}){this.#t=t,this.#r=r.onReceive||(()=>{}),this.#e=r.onError||(()=>{}),this.#a()}#a(){let t=this.#t;t.classList.add("tref-receiver"),t.addEventListener("dragover",r=>{r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect="copy"),t.classList.add("tref-receiver-active")}),t.addEventListener("dragleave",()=>{t.classList.remove("tref-receiver-active")}),t.addEventListener("drop",r=>{if(r.preventDefault(),t.classList.remove("tref-receiver-active"),!r.dataTransfer){this.#e(new Error("No data"));return}let a=h(r.dataTransfer);a?(t.classList.add("tref-receiver-success"),setTimeout(()=>t.classList.remove("tref-receiver-success"),1e3),this.#r(a)):(t.classList.add("tref-receiver-error"),setTimeout(()=>t.classList.remove("tref-receiver-error"),1e3),this.#e(new Error("Invalid TREF data")))})}get element(){return this.#t}showBlock(t){this.#t.innerHTML=t.toHTML(),this.#t.classList.add("tref-receiver-has-block")}clear(){this.#t.innerHTML=this.#t.dataset.placeholder||"Drop TREF here",this.#t.classList.remove("tref-receiver-has-block")}static getStyles(){return`
.tref-receiver {
  border: 2px dashed #5CCCCC;
  border-radius: 8px;
  padding: 20px;
  min-height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #6b7280;
  background: #f9fafb;
  transition: all 0.2s;
}
.tref-receiver-active {
  border-color: #8B5CF6;
  background: #f3e8ff;
  color: #8B5CF6;
}
.tref-receiver-success {
  border-color: #10B981;
  background: #ecfdf5;
}
.tref-receiver-error {
  border-color: #ef4444;
  background: #fef2f2;
}
.tref-receiver-has-block {
  border-style: solid;
  background: white;
}
`}};function p(e){return new l(e)}function h(e){try{let t;if(typeof e=="string")t=e;else if(e&&typeof e.getData=="function")t=e.getData(c)||e.getData("application/json")||e.getData("text/plain");else return null;return t?p(JSON.parse(t)):null}catch{return null}}function y(e){if(Array.isArray(e))return e.map(y);if(e!==null&&typeof e=="object"){let t={},r=e;for(let a of Object.keys(r).sort())t[a]=y(r[a]);return t}return e}async function F(e){let t=new TextEncoder,r=await crypto.subtle.digest("SHA-256",t.encode(e));return Array.from(new Uint8Array(r)).map(a=>a.toString(16).padStart(2,"0")).join("")}async function m(e){let t=JSON.stringify(y(e));return`sha256:${await F(t)}`}function b(e,t={}){let r={v:1,content:e,meta:{created:new Date().toISOString(),license:t.license||"CC-BY-4.0"}};return t.author&&(r.meta.author=t.author),t.refs&&t.refs.length>0&&(r.refs=t.refs),t.parent&&(r.parent=t.parent),r}async function w(e,t={}){let r=b(e,t),a=await m(r);return{...r,id:a}}async function C(e,t,r={}){return w(t,{...r,license:r.license||e.meta.license,parent:e.id})}async function T(e){let{id:t,...r}=e,a=await m(r);return t===a}function E(){return l.getStyles()+f.getStyles()}typeof window<"u"&&(window.TREF={TrefWrapper:l,TrefReceiver:f,publish:w,derive:C,validate:T,createDraft:b,wrap:p,unwrap:h,getStyles:E,TREF_ICON_SVG:d,TREF_ICON_DATA_URL:v,TREF_MIME_TYPE:c});return O(M);})();
