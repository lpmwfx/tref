"use strict";var TREF=(()=>{var f=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var L=(r,e)=>{for(var t in e)f(r,t,{get:e[t],enumerable:!0})},T=(r,e,t,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of m(e))!C.call(r,s)&&s!==t&&f(r,s,{get:()=>e[s],enumerable:!(a=b(e,s))||a.enumerable});return r};var E=r=>T(f({},"__esModule",{value:!0}),r);var D={};L(D,{TREF_ICON_SVG:()=>p,TREF_MIME_TYPE:()=>o,TrefReceiver:()=>c,TrefWrapper:()=>i,createDraft:()=>d,derive:()=>v,getStyles:()=>w,publish:()=>u,unwrap:()=>g,validate:()=>x,wrap:()=>y});var p=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="24" height="24">
  <rect x="6" y="6" width="88" height="88" rx="12" ry="12" fill="#2D1B4E" stroke="#5CCCCC" stroke-width="5"/>
  <g transform="translate(50 50) scale(0.022) translate(-1125 -1125)">
    <g transform="translate(0,2250) scale(1,-1)" fill="#5CCCCC">
      <path d="M1515 2244 c-66 -10 -144 -38 -220 -77 -67 -35 -106 -67 -237 -195 -155 -152 -188 -195 -188 -247 0 -41 30 -95 64 -116 39 -24 113 -25 146 -3 14 9 90 81 170 160 183 181 216 199 350 199 83 0 103 -4 155 -28 78 -36 146 -104 182 -181 24 -53 28 -73 28 -151 0 -137 -21 -175 -199 -355 -79 -80 -151 -156 -160 -170 -39 -59 -8 -162 58 -194 81 -38 113 -22 284 147 165 163 230 252 268 370 24 71 28 99 28 202 0 106 -3 130 -28 200 -91 261 -310 428 -579 439 -50 3 -105 2 -122 0z"/>
      <path d="M1395 1585 c-17 -9 -189 -174 -382 -368 -377 -378 -383 -385 -362 -461 21 -76 87 -116 166 -101 33 6 80 49 386 353 191 191 358 362 369 381 26 42 28 109 4 146 -39 59 -118 81 -181 50z"/>
      <path d="M463 1364 c-47 -24 -323 -310 -365 -379 -20 -33 -49 -96 -64 -140 -24 -69 -28 -96 -28 -195 0 -127 14 -190 66 -294 63 -126 157 -220 284 -284 104 -52 167 -66 294 -66 99 0 126 4 195 28 44 15 107 44 140 64 65 39 348 309 371 354 41 78 -10 184 -96 203 -61 13 -98 -11 -256 -166 -186 -183 -222 -204 -359 -204 -77 0 -98 4 -147 27 -79 37 -142 98 -181 177 -29 59 -32 74 -32 156 0 136 21 174 199 355 79 80 150 156 159 170 23 33 22 107 -2 146 -35 57 -115 79 -178 48z"/>
    </g>
  </g>
</svg>`,o="application/vnd.aiblocks.tref+json";function l(r){if(Array.isArray(r))return r.map(l);if(r!==null&&typeof r=="object"){let e={},t=r;for(let a of Object.keys(t).sort())e[a]=l(t[a]);return e}return r}function S(r){return r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}async function k(r){let e=new TextEncoder,t=await crypto.subtle.digest("SHA-256",e.encode(r));return Array.from(new Uint8Array(t)).map(a=>a.toString(16).padStart(2,"0")).join("")}function d(r,e={}){let t={v:1,content:r,meta:{created:new Date().toISOString(),license:e.license||"CC-BY-4.0"}};return e.author&&(t.meta.author=e.author),e.refs&&e.refs.length>0&&(t.refs=e.refs),e.parent&&(t.parent=e.parent),t}async function h(r){let e=JSON.stringify(l(r));return`sha256:${await k(e)}`}async function u(r,e={}){let t=d(r,e),a=await h(t);return{...t,id:a}}async function v(r,e,t={}){let a=[...r.refs||[],...t.refs||[]],s=d(e,{author:t.author,license:t.license||r.meta.license,refs:a.length>0?a:void 0,parent:r.id}),n=await h(s);return{...s,id:n}}async function x(r){try{let{id:e,...t}=r,a=await h(t);return e!==a?{valid:!1,error:`ID mismatch: expected ${a}`}:{valid:!0}}catch(e){return{valid:!1,error:e instanceof Error?e.message:String(e)}}}var i=class{#e;constructor(e){if(!e||e.v!==1||!e.id||!e.content)throw new Error("Invalid TREF block");this.#e=e}get block(){return this.#e}get id(){return this.#e.id}get shortId(){return this.#e.id.replace("sha256:","").slice(0,8)}get content(){return this.#e.content}toJSON(e={}){return e.pretty?JSON.stringify(this.#e,null,2):JSON.stringify(this.#e)}getFilename(){return this.#e.id.replace("sha256:","")+".tref"}toBlob(){return new Blob([this.toJSON()],{type:o})}toObjectURL(){return URL.createObjectURL(this.toBlob())}async copyToClipboard(){await navigator.clipboard.writeText(this.toJSON())}async copyContentToClipboard(){await navigator.clipboard.writeText(this.#e.content)}getDragData(){let e=this.toJSON();return[{type:o,data:e},{type:"application/json",data:e},{type:"text/plain",data:e}]}setDragData(e){for(let{type:t,data:a}of this.getDragData())e.setData(t,a)}toHTML(e={}){let{maxContentLength:t=200}=e,a=this.#e.content.length>t?this.#e.content.slice(0,t)+"...":this.#e.content,s=this.#e.refs&&this.#e.refs.length>0?`<div class="tref-refs">
        <strong>Refs:</strong> ${this.#e.refs.filter(n=>n.type==="url"&&n.url).map(n=>`<a href="${n.url}" target="_blank">${n.label||n.url}</a>`).join(", ")}
      </div>`:"";return`<div class="tref-wrapper" data-tref-id="${this.#e.id}">
  <div class="tref-header">
    <span class="tref-icon">${p}</span>
    <span class="tref-id">${this.shortId}</span>
    <span class="tref-meta">${this.#e.meta.created.split("T")[0]}</span>
  </div>
  <div class="tref-content">${S(a)}</div>
  ${s}
</div>`}static getStyles(){return`
.tref-wrapper {
  font-family: system-ui, -apple-system, sans-serif;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  padding: 12px;
  background: #fafafa;
  max-width: 400px;
}
.tref-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}
.tref-icon { display: inline-flex; width: 24px; height: 24px; }
.tref-icon svg { width: 100%; height: 100%; }
.tref-id {
  font-family: monospace;
  font-size: 12px;
  color: #6b7280;
  background: #e5e7eb;
  padding: 2px 6px;
  border-radius: 4px;
}
.tref-meta { font-size: 12px; color: #9ca3af; margin-left: auto; }
.tref-content {
  font-size: 14px;
  line-height: 1.5;
  color: #374151;
  white-space: pre-wrap;
  word-break: break-word;
}
.tref-refs {
  margin-top: 8px;
  padding-top: 8px;
  border-top: 1px solid #e5e7eb;
  font-size: 12px;
  color: #6b7280;
}
.tref-refs a { color: #5CCCCC; text-decoration: none; }
.tref-refs a:hover { text-decoration: underline; }
.tref-wrapper[draggable="true"] { cursor: grab; }
.tref-wrapper[draggable="true"]:active { cursor: grabbing; }`}},c=class{#e;#r;#t;constructor(e,t={}){this.#e=e,this.#r=t.onReceive||(()=>{}),this.#t=t.onError||(()=>{}),this.#a()}#a(){let e=this.#e;e.classList.add("tref-receiver"),e.addEventListener("dragover",t=>{t.preventDefault(),t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),e.classList.add("tref-receiver-active")}),e.addEventListener("dragleave",()=>{e.classList.remove("tref-receiver-active")}),e.addEventListener("drop",t=>{if(t.preventDefault(),e.classList.remove("tref-receiver-active"),!t.dataTransfer){this.#t(new Error("No data"));return}let a=g(t.dataTransfer);a?(e.classList.add("tref-receiver-success"),setTimeout(()=>e.classList.remove("tref-receiver-success"),1e3),this.#r(a)):(e.classList.add("tref-receiver-error"),setTimeout(()=>e.classList.remove("tref-receiver-error"),1e3),this.#t(new Error("Invalid TREF data")))})}get element(){return this.#e}showBlock(e){this.#e.innerHTML=e.toHTML(),this.#e.classList.add("tref-receiver-has-block")}clear(){this.#e.innerHTML=this.#e.dataset.placeholder||"Drop TREF here",this.#e.classList.remove("tref-receiver-has-block")}static getStyles(){return`
.tref-receiver {
  border: 2px dashed #5CCCCC;
  border-radius: 8px;
  padding: 20px;
  min-height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #6b7280;
  background: #f9fafb;
  transition: all 0.2s;
}
.tref-receiver-active {
  border-color: #8B5CF6;
  background: #f3e8ff;
  color: #8B5CF6;
}
.tref-receiver-success {
  border-color: #10B981;
  background: #ecfdf5;
}
.tref-receiver-error {
  border-color: #ef4444;
  background: #fef2f2;
}
.tref-receiver-has-block {
  border-style: solid;
  background: white;
}`}};function y(r){return new i(r)}function g(r){try{let e;if(typeof r=="string"?e=r:r&&typeof r.getData=="function"&&(e=r.getData(o)||r.getData("application/json")||r.getData("text/plain")),!e)return null;let t=JSON.parse(e);return t.v===1&&t.id&&t.content?new i(t):null}catch{return null}}function w(){return i.getStyles()+c.getStyles()}typeof window<"u"&&(window.TREF={TrefWrapper:i,TrefReceiver:c,publish:u,derive:v,validate:x,createDraft:d,wrap:y,unwrap:g,getStyles:w,TREF_ICON_SVG:p,TREF_MIME_TYPE:o});return E(D);})();
