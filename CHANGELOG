# CHANGELOG

Finished changes for TREF project.

## [0.4.0] - 2026-01-09 (WIP)

### Added
- **Smart Hover Menu Positioning**: Menu adapts to viewport boundaries
  - Centered by default
  - Shifts left/right when near screen edges
  - Appears above when near bottom of viewport
  - Uses `requestAnimationFrame` for accurate positioning
- **Mobile Touch Copy-Paste**: Clipboard-based transfer on touch devices
  - Long-press icon (300ms) → copy to clipboard + "Copied ✓" popup
  - Tap receiver → "Tap to paste" state → tap again → paste
- **Mobile-First CSS**: Responsive design across all screen sizes
  - Breakpoints: 480px, 640px, 768px, 1024px
  - Code blocks scroll horizontally on mobile
  - Touch-friendly hit areas (44×44px minimum)

### Changed
- **Refactored wrapper.js** into focused modules:
  - `shared.js` - Constants, icons, validation
  - `TrefWrapper.js` - Sender component + CSS
  - `TrefReceiver.js` - Receiver component + CSS
  - `index.js` - Entry point, re-exports
- Simplified `doc/TrefBlockUIUX.md` to pure UI/UX spec (152 lines vs 796)

### Fixed
- SHA-256 validation mismatch (publish now hashes content only)
- Code block overflow on mobile
- Wiki sidebar height on mobile (uses 100dvh)

---

## [0.3.0] - 2026-01-08

### Added
- **SHA-256 Validation**: Automatic content integrity verification
  - `wrapper.validate()` method returns `{ valid, expected, actual }`
  - `validateBlock(block)` standalone function
  - Auto-validation on `attachEvents()` (can disable with `validateOnAttach: false`)
  - Visual indicator for invalid blocks: red X icon + "Modified content" warning
  - `TREF_ICON_INVALID_SVG` export for custom use
- **Version History**: Track article versions with history popup
  - History button in hover menu (rotate-ccw icon)
  - Fetches from `data-history` attribute URL
  - Shows version list with dates and IDs
  - `history.json` format: `{ current, versions: [{ v, id, date }] }`
- New example pages: `examples/validation.html`, `examples/history.html`
- Blog publishing guide: `doc/blog-publishing.md`

### Changed
- ID generation now based on content only (not entire block) for simpler validation
- CSS: Added `.tref-invalid`, `.tref-warning` styles
- browser.js: Updated to match content-based ID generation
- Cache-busting: All docs HTML files use `?v=0.3.0` on CSS/JS imports

---

## [0.2.0] - 2026-01-07

### Added
- TrefWrapper dropdown menu with Copy Content, Copy JSON, Download actions
- Auto TREF block generation from markdown at commit time (bin/build-docs.js)
- Git pre-commit hook for automatic block builds

### Changed
- Renamed AIBlock typedef to TrefBlock throughout source code
- License identifier changed from AIBlocks-1.0 to TREF-1.0
- Schema URL updated to https://tref.lpmwfx.com/schema
- CSS refactored to single unified stylesheet (docs/css/tref-site.css)
  - Removed all inline `<style>` blocks from HTML
  - Dark mode works automatically via CSS custom properties
- Documentation site complete (tref.lpmwfx.com)
  - index.html, builder.html, guide.html, about-cli.html
  - examples.html, examples/drag-drop.html, examples/ai-chat.html

---

## [0.1.0] - 2026-01-07

### Added
- Single-source architecture: src/ → dist/ → CDN/npm
- npm run build:browser bundles wrapper.js to dist/tref-block.js (10kb)
- Package exports for ESM and CJS
- CDN support via jsdelivr/unpkg
- Phase 1: Block Format Specification v1.0
- Block schema: v, id, content, meta, origin, refs, parent
- Reference types: url, archive, search, hash
- ID format: sha256:<64 hex chars> (content-based)
- Canonical JSON spec for deterministic ID generation
- Phase 2: Publisher Core (publish, derive, validate, file I/O, registry)
- Phase 3: TrefWrapper and TrefReceiver classes
- Phase 4: CLI tool (tref) and MCP server (tref-mcp)
- 167 tests passing

### UI/UX
- Hover menu as dropdown overlay
- SVG icons for all action buttons
- Accessibility: ARIA roles, keyboard navigation, focus-visible
- Touch support: tap-to-toggle, long-press for drag
- Compact receiver mode (32x32)

### Documentation
- doc/project.md, doc/format.md, doc/license.md, doc/publisher.md
- doc/TrefBlockUIUX.md: Complete UI/UX specification
- CLAUDE.md, README.md

---
